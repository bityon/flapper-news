{"filter":false,"title":"index.js","tooltip":"/routes/index.js","undoManager":{"mark":4,"position":4,"stack":[[{"group":"doc","deltas":[{"start":{"row":21,"column":3},"end":{"row":22,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":22,"column":0},"end":{"row":23,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":0},"end":{"row":34,"column":3},"action":"insert","lines":["// Preload comment objects on routes with ':comment'","router.param('comment', function(req, res, next, id) {","    var query = Comment.findById(id);","","    query.exec(function (err, comment){","        if (err) { return next(err); }","        if (!comment) { return next(new Error(\"can't find comment\")); }","","        req.comment = comment;","        return next();","    });","});"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":93,"column":0},"action":"remove","lines":["var express = require('express');","var router = express.Router();","","","/* GET home page. */","router.get('/', function(req, res, next) {","  res.render('index', { title: 'Express' });","});","","module.exports = router;","","router.param('post', function(req, res, next, id) {","  var query = Post.findById(id);","","  query.exec(function (err, post){","    if (err) { return next(err); }","    if (!post) { return next(new Error('can\\'t find post')); }","","    req.post = post;","    return next();","  });","});","","// Preload comment objects on routes with ':comment'","router.param('comment', function(req, res, next, id) {","    var query = Comment.findById(id);","","    query.exec(function (err, comment){","        if (err) { return next(err); }","        if (!comment) { return next(new Error(\"can't find comment\")); }","","        req.comment = comment;","        return next();","    });","});","","var mongoose = require('mongoose');","var Post = mongoose.model('Post');","var Comment = mongoose.model('Comment');","","router.get('/posts', function(req, res, next) {","  Post.find(function(err, posts){","    if(err){ return next(err); }","","    res.json(posts);","  });","});","","router.post('/posts', function(req, res, next) {","  var post = new Post(req.body);","","  post.save(function(err, post){","    if(err){ return next(err); }","","    res.json(post);","  });","});","","router.get('/posts/:post', function(req, res) {","  res.json(req.post);","});","","router.put('/posts/:post/upvote', function(req, res, next) {","  req.post.upvote(function(err, post){","    if (err) { return next(err); }","","    res.json(post);","  });","});","","router.post('/posts/:post/comments', function(req, res, next) {","  var comment = new Comment(req.body);","  comment.post = req.post;","","  comment.save(function(err, comment){","    if(err){ return next(err); }","","    req.post.comments.push(comment);","    req.post.save(function(err, post) {","      if(err){ return next(err); }","","      res.json(comment);","    });","  });","});","","router.get('/posts/:post', function(req, res, next) {","  req.post.populate('comments', function(err, post) {","    if (err) { return next(err); }","","    res.json(post);","  });","});",""]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":103,"column":24},"action":"insert","lines":["var express = require('express');","var router = express.Router();","","","/* GET home page. */","router.get('/', function(req, res, next) {","  res.render('index', { title: 'Express' });","});","","var mongoose = require('mongoose');","var Post = mongoose.model('Post');","var Comment = mongoose.model('Comment');","","// module.exports = router;","","router.get('/posts', function(req, res, next) {","  Post.find(function(err, posts){","    if(err){ return next(err); }","","    res.json(posts);","  });","});","","router.post('/posts', function(req, res, next) {","  var post = new Post(req.body);","","  post.save(function(err, post){","    if(err){ return next(err); }","","    res.json(post);","  });","});","","","","// Preload post objects on routes with ':post'","router.param('post', function(req, res, next, id) {","    var query = Post.findById(id);","","    query.exec(function (err, post){","        if (err) { return next(err); }","        if (!post) { return next(new Error(\"can't find post\")); }","","        req.post = post;","        return next();","    });","});","","// Preload comment objects on routes with ':comment'","router.param('comment', function(req, res, next, id) {","    var query = Comment.findById(id);","","    query.exec(function (err, comment){","        if (err) { return next(err); }","        if (!comment) { return next(new Error(\"can't find comment\")); }","","        req.comment = comment;","        return next();","    });","});","","// return a post","router.get('/posts/:post', function(req, res) {","  req.post.populate('comments', function(err, post) {","        res.json(post);","    });","  // res.json(req.post);","});","","router.put('/posts/:post/upvote', function(req, res, next) {","  req.post.upvote(function(err, post){","    if (err) { return next(err); }","","    res.json(post);","  });","});","","// create a new comment","router.post('/posts/:post/comments', function(req, res, next) {","  var comment = new Comment(req.body);","  comment.post = req.post;","","  comment.save(function(err, comment){","    if(err){ return next(err); }","","    req.post.comments.push(comment);","    req.post.save(function(err, post) {","      if(err){ return next(err); }","","      res.json(comment);","    });","  });","});","","// upvote a comment","router.put('/posts/:post/comments/:comment/upvote', function(req, res, next) {","    req.comment.upvote(function(err, comment){","        if (err) { return next(err); }","","        res.json(comment);","    });","});","","module.exports = router;"]}]}]]},"ace":{"folds":[],"customSyntax":"javascript","scrolltop":933,"scrollleft":0,"selection":{"start":{"row":103,"column":24},"end":{"row":103,"column":24},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":65,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1424259493043,"hash":"881b4402f0649ada941159b3fa94598aac87a4c7"}